/*!
 * Vue-Lazyload.js v1.0.0-rc10
 * (c) 2017 Awe <hilongjw@gmail.com>
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueLazyload=e()}(this,function(){"use strict";function t(t,e){if(t.length){var i=t.indexOf(e);return i>-1?t.splice(i,1):void 0}}function e(t,e){if(!t||!e)return t||{};if(t instanceof Object)for(var i in e)t[i]=e[i];return t}function i(t,e){for(var i=!1,n=0,r=t.length;n<r;n++)if(e(t[n])){i=!0;break}return i}function n(t,e){if("IMG"===t.tagName&&t.getAttribute("srcset")){var i=t.getAttribute("srcset"),n=[],r=t.parentNode,o=r.offsetWidth*e,s=void 0,a=void 0,u=void 0;i=i.trim().split(","),i.map(function(t){t=t.trim(),s=t.lastIndexOf(" "),s===-1?(a=t,u=999998):(a=t.substr(0,s),u=parseInt(t.substr(s+1,t.length-s-2),10)),n.push([u,a])}),n.sort(function(t,e){if(t[0]<e[0])return-1;if(t[0]>e[0])return 1;if(t[0]===e[0]){if(e[1].indexOf(".webp",e[1].length-5)!==-1)return 1;if(t[1].indexOf(".webp",t[1].length-5)!==-1)return-1}return 0});for(var l="",d=void 0,h=n.length,c=0;c<h;c++)if(d=n[c],d[0]>=o){l=d[1];break}return l}}function r(t,e){for(var i=void 0,n=0,r=t.length;n<r;n++)if(e(t[n])){i=t[n];break}return i}function o(){if(!a)return!1;var t=!0,e=document;try{var i=e.createElement("object");i.type="image/webp",i.innerHTML="!",e.body.appendChild(i),t=!i.offsetWidth,e.body.removeChild(i)}catch(e){t=!1}return t}function s(t,e){var i=null,n=0;return function(){if(!i){var r=Date.now()-n,o=this,s=arguments,a=function(){n=Date.now(),i=!1,t.apply(o,s)};r>=e?a():i=setTimeout(a,e)}}}var a="undefined"!=typeof window,u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return a&&window.devicePixelRatio||t},l={on:function(t,e,i){t.addEventListener(e,i)},off:function(t,e,i){t.removeEventListener(e,i)}},d=function(t,e,i){var n=new Image;n.src=t.src,n.onload=function(){e({naturalHeight:n.naturalHeight,naturalWidth:n.naturalWidth,src:n.src})},n.onerror=function(t){i(t)}},h=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},c=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),f={},p=function(){function t(e){var i=e.el,n=e.src,r=e.error,o=e.loading,s=e.bindType,a=e.$parent,u=e.options,l=e.elRenderer;h(this,t),this.el=i,this.src=n,this.error=r,this.loading=o,this.bindType=s,this.attempt=0,this.naturalHeight=0,this.naturalWidth=0,this.options=u,this.initState(),this.performanceData={init:Date.now(),loadStart:null,loadEnd:null},this.rect=i.getBoundingClientRect(),this.$parent=a,this.elRenderer=l}return c(t,[{key:"initState",value:function(){this.state={error:!1,loaded:!1,rendered:!1}}},{key:"record",value:function(t){this.performanceData[t]=Date.now()}},{key:"update",value:function(t){var e=t.src,i=t.loading,n=t.error;this.src=e,this.loading=i,this.error=n,this.attempt=0,this.initState()}},{key:"getRect",value:function(){this.rect=this.el.getBoundingClientRect()}},{key:"checkInView",value:function(){return this.getRect(),this.rect.top<window.innerHeight*this.options.preLoad&&this.rect.bottom>0&&this.rect.left<window.innerWidth*this.options.preLoad&&this.rect.right>0}},{key:"load",value:function(){var t=this;return this.attempt>this.options.attempt-1&&this.state.error?void(this.options.silent||console.log("error end")):this.state.loaded||f[this.src]?this.render("loaded"):(this.render("loading",!0),this.attempt++,this.record("loadStart"),void d({src:this.src},function(e){t.src=e.src,t.naturalHeight=e.naturalHeight,t.naturalWidth=e.naturalWidth,t.state.loaded=!0,t.state.error=!1,t.record("loadEnd"),t.render("loaded",!0),f[t.src]=1},function(e){t.state.error=!0,t.state.loaded=!1,t.render("error",!0)}))}},{key:"render",value:function(t,e){this.elRenderer(this,t,e)}},{key:"performance",value:function(){var t="loading",e=0;return this.state.loaded&&(t="loaded",e=(this.performanceData.loadEnd-this.performanceData.loadStart)/1e3),this.state.error&&(t="error"),{src:this.src,state:t,time:e}}},{key:"destroy",value:function(){this.el=null,this.src=null,this.error=null,this.loading=null,this.bindType=null,this.attempt=0}}]),t}(),v="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",g=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],y=function(e){return function(){function a(t){var e=this,i=t.preLoad,n=t.error,r=t.loading,l=t.attempt,d=t.silent,c=t.scale,f=t.listenEvents,p=(t.hasbind,t.filter),y=t.adapter;h(this,a),this.ListenerQueue=[],this.options={silent:d||!0,preLoad:i||1.3,error:n||v,loading:r||v,attempt:l||3,scale:u(c),ListenEvents:f||g,hasbind:!1,supportWebp:o(),filter:p||{},adapter:y||{}},this.initEvent(),this.lazyLoadHandler=s(function(){var t=!1;e.ListenerQueue.forEach(function(e){e.state.loaded||(t=e.checkInView(),t&&e.load())})},200)}return c(a,[{key:"addLazyBox",value:function(t){this.ListenerQueue.push(t),this.options.hasbind=!0,this.initListen(window,!0)}},{key:"add",value:function(t,r,o){var s=this;if(i(this.ListenerQueue,function(e){return e.el===t}))return this.update(t,r),e.nextTick(this.lazyLoadHandler);var a=this.valueFormatter(r.value),u=a.src,l=a.loading,d=a.error;e.nextTick(function(){var i=n(t,s.options.scale);i&&(u=i);var a=Object.keys(r.modifiers)[0],h=void 0;a&&(h=o.context.$refs[a],h=h?h.$el||h:document.getElementById(a)),s.ListenerQueue.push(s.listenerFilter(new p({bindType:r.arg,$parent:h,el:t,loading:l,error:d,src:u,elRenderer:s.elRenderer.bind(s),options:s.options}))),s.ListenerQueue.length&&!s.options.hasbind&&(s.options.hasbind=!0,s.initListen(window,!0),h&&s.initListen(h,!0),s.lazyLoadHandler(),e.nextTick(function(){return s.lazyLoadHandler()}))})}},{key:"update",value:function(t,i){var n=this,o=this.valueFormatter(i.value),s=o.src,a=o.loading,u=o.error,l=r(this.ListenerQueue,function(e){return e.el===t});l&&l.src!==s&&l.update({src:s,loading:a,error:u}),this.lazyLoadHandler(),e.nextTick(function(){return n.lazyLoadHandler()})}},{key:"remove",value:function(e){if(e){var i=r(this.ListenerQueue,function(t){return t.el===e});i&&t(this.ListenerQueue,i)&&i.destroy(),this.options.hasbind&&!this.ListenerQueue.length&&this.initListen(window,!1)}}},{key:"initListen",value:function(t,e){var i=this;this.options.hasbind=e,this.options.ListenEvents.forEach(function(n){return l[e?"on":"off"](t,n,i.lazyLoadHandler)})}},{key:"initEvent",value:function(){var e=this;this.Event={listeners:{loading:[],loaded:[],error:[]}},this.$on=function(t,i){e.Event.listeners[t].push(i)},this.$once=function(t,i){function n(){r.$off(t,n),i.apply(r,arguments)}var r=e;e.$on(t,n)},this.$off=function(i,n){return n?void t(e.Event.listeners[i],n):void(e.Event.listeners[i]=[])},this.$emit=function(t,i){e.Event.listeners[t].forEach(function(t){return t(i)})}}},{key:"performance",value:function(){var t=[];return this.ListenerQueue.map(function(e){t.push(e.performance())}),t}},{key:"elRenderer",value:function(t,e,i){if(t.el){var n=t.el,r=t.bindType,o=void 0;switch(e){case"loading":o=t.loading;break;case"error":o=t.error;break;default:o=t.src}r?n.style[r]="url("+o+")":n.getAttribute("src")!==o&&n.setAttribute("src",o),n.setAttribute("lazy",e),i&&(this.$emit(e,t),this.options.adapter[e]&&this.options.adapter[e](t,this.options))}}},{key:"listenerFilter",value:function(t){return this.options.filter.webp&&this.options.supportWebp&&(t.src=this.options.filter.webp(t,this.options)),this.options.filter.customer&&(t.src=this.options.filter.customer(t,this.options)),t}},{key:"valueFormatter",value:function(t){var i=t,n=this.options.loading,r=this.options.error;return e.util.isObject(t)&&(t.src||this.options.silent||e.util.warn("Vue Lazyload warning: miss src with "+t),i=t.src,n=t.loading||this.options.loading,r=t.error||this.options.error),{src:i,loading:n,error:r}}}]),a}()},m=function(t){return{props:{tag:{type:String,default:"div"}},render:function(t){return this.show===!1?t(this.tag,{attrs:{class:"cov"}}):t(this.tag,{attrs:{class:"cov"}},this.$slots.default)},data:function(){return{state:{loaded:!1},rect:{},show:!1}},mounted:function(){t.addLazyBox(this),t.lazyLoadHandler()},methods:{getRect:function(){this.rect=this.$el.getBoundingClientRect()},checkInView:function(){return this.getRect(),a&&this.rect.top<window.innerHeight*t.options.preLoad&&this.rect.bottom>0&&this.rect.left<window.innerWidth*t.options.preLoad&&this.rect.right>0},load:function(){if("undefined"!=typeof this.$el.attributes.lazy&&"undefined"!=typeof this.$el.attributes.lazy.value){var e=this.$el.attributes.lazy.value;this.state.loaded="loaded"===e,this.state.error="error"===e,this.$emit(e,this.$el)}else this.$emit("loading",this.$el),this.$nextTick(t.lazyLoadHandler);this.show=!0}}}},b={install:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=y(t),r=new n(i),o="2"===t.version.split(".")[0];t.prototype.$Lazyload=r,t.component("lazy-component",m(r)),o?t.directive("lazy",{bind:r.add.bind(r),update:r.update.bind(r),componentUpdated:r.lazyLoadHandler.bind(r),unbind:r.remove.bind(r)}):t.directive("lazy",{bind:r.lazyLoadHandler.bind(r),update:function(t,i){e(this.vm.$refs,this.vm.$els),r.add(this.el,{modifiers:this.modifiers||{},arg:this.arg,value:t,oldValue:i},{context:this.vm})},unbind:function(){r.remove(this.el)}})}};return b});