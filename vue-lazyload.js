/*!
 * Vue-Lazyload.js v1.1.4
 * (c) 2018 Awe <hilongjw@gmail.com>
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueLazyload=t()}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i="undefined"!=typeof window,r=i&&"IntersectionObserver"in window,o={event:"event",observer:"observer"};function s(e,t){if(e.length){var n=e.indexOf(t);return n>-1?e.splice(n,1):void 0}}function a(e,t){if(!e||!t)return e||{};if(e instanceof Object)for(var n in t)e[n]=t[n];return e}function u(e,t){if("IMG"===e.tagName&&e.getAttribute("data-srcset")){var n=e.getAttribute("data-srcset"),i=[],r=e.parentNode.offsetWidth*t,o=void 0,s=void 0,a=void 0;(n=n.trim().split(",")).map(function(e){e=e.trim(),-1===(o=e.lastIndexOf(" "))?(s=e,a=999998):(s=e.substr(0,o),a=parseInt(e.substr(o+1,e.length-o-2),10)),i.push([a,s])}),i.sort(function(e,t){if(e[0]<t[0])return-1;if(e[0]>t[0])return 1;if(e[0]===t[0]){if(-1!==t[1].indexOf(".webp",t[1].length-5))return 1;if(-1!==e[1].indexOf(".webp",e[1].length-5))return-1}return 0});for(var u="",l=void 0,d=i.length,h=0;h<d;h++)if((l=i[h])[0]>=r){u=l[1];break}return u}}function l(e,t){for(var n=void 0,i=0,r=e.length;i<r;i++)if(t(e[i])){n=e[i];break}return n}var d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return i&&window.devicePixelRatio||e};var h=function(){if(i){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(e){}return e}}(),c={on:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];h?e.addEventListener(t,n,{capture:i,passive:!0}):e.addEventListener(t,n,i)},off:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.removeEventListener(t,n,i)}},f=function(e,t,n){var i=new Image;i.src=e.src,i.onload=function(){t({naturalHeight:i.naturalHeight,naturalWidth:i.naturalWidth,src:i.src})},i.onerror=function(e){n(e)}},v=function(e,t){return"undefined"!=typeof getComputedStyle?getComputedStyle(e,null).getPropertyValue(t):e.style[t]},p=function(e){if(i){if(!(e instanceof HTMLElement))return window;for(var t,n=e;n&&n!==document.body&&n!==document.documentElement&&n.parentNode;){if(/(scroll|auto)/.test(v(t=n,"overflow")+v(t,"overflow-y")+v(t,"overflow-x")))return n;n=n.parentNode}return window}};var g={},y=function(){function e(n){var i=n.el,r=n.src,o=n.error,s=n.loading,a=n.bindType,u=n.$parent,l=n.options,d=n.elRenderer;t(this,e),this.el=i,this.src=r,this.error=o,this.loading=s,this.bindType=a,this.attempt=0,this.naturalHeight=0,this.naturalWidth=0,this.options=l,this.filter(),this.initState(),this.performanceData={init:Date.now(),loadStart:null,loadEnd:null},this.rect=i.getBoundingClientRect(),this.$parent=u,this.elRenderer=d,this.render("loading",!1)}return n(e,[{key:"initState",value:function(){this.state={error:!1,loaded:!1,rendered:!1}}},{key:"record",value:function(e){this.performanceData[e]=Date.now()}},{key:"update",value:function(e){var t=e.src,n=e.loading,i=e.error,r=this.src;this.src=t,this.loading=n,this.error=i,this.filter(),r!==this.src&&(this.attempt=0,this.initState())}},{key:"getRect",value:function(){this.rect=this.el.getBoundingClientRect()}},{key:"checkInView",value:function(){return this.getRect(),this.rect.top<window.innerHeight*this.options.preLoad&&this.rect.bottom>this.options.preLoadTop&&this.rect.left<window.innerWidth*this.options.preLoad&&this.rect.right>0}},{key:"filter",value:function(){var e=this;(function(e){if(!(e instanceof Object))return[];if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t})(this.options.filter).map(function(t){e.options.filter[t](e,e.options)})}},{key:"renderLoading",value:function(e){var t=this;f({src:this.loading},function(n){t.render("loading",!1),e()},function(n){e(),t.options.silent||console.warn("VueLazyload log: load failed with loading image("+t.loading+")")})}},{key:"load",value:function(e){var t=this;return this.attempt>this.options.attempt-1&&this.state.error?(this.options.silent||console.log("VueLazyload log: "+this.src+" tried too more than "+this.options.attempt+" times"),void e()):this.state.loaded||g[this.src]?(this.state.loaded=!0,e(),this.render("loaded",!0)):void this.renderLoading(function(){t.attempt++,t.record("loadStart"),f({src:t.src},function(n){t.naturalHeight=n.naturalHeight,t.naturalWidth=n.naturalWidth,t.state.loaded=!0,t.state.error=!1,t.record("loadEnd"),t.render("loaded",!1),g[t.src]=1,e()},function(e){t.state.error=!0,t.state.loaded=!1,t.render("error",!1)})})}},{key:"render",value:function(e,t){this.elRenderer(this,e,t)}},{key:"performance",value:function(){var e="loading",t=0;return this.state.loaded&&(e="loaded",t=(this.performanceData.loadEnd-this.performanceData.loadStart)/1e3),this.state.error&&(e="error"),{src:this.src,state:e,time:t}}},{key:"destroy",value:function(){this.el=null,this.src=null,this.error=null,this.loading=null,this.bindType=null,this.attempt=0}}]),e}(),b="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",m=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],L={rootMargin:"0px",threshold:0};function w(h){return function(){function f(e){var n,r,s,a,u=e.preLoad,l=e.error,h=e.throttleWait,c=e.preLoadTop,v=e.dispatchEvent,p=e.loading,g=e.attempt,y=e.silent,w=void 0===y||y,_=e.scale,k=e.listenEvents,E=(e.hasbind,e.filter),A=e.adapter,T=e.observer,$=e.observerOptions;t(this,f),this.version="1.1.4",this.mode=o.event,this.ListenerQueue=[],this.TargetIndex=0,this.TargetQueue=[],this.options={silent:w,dispatchEvent:!!v,throttleWait:h||200,preLoad:u||1.3,preLoadTop:c||0,error:l||b,loading:p||b,attempt:g||3,scale:_||d(_),ListenEvents:k||m,hasbind:!1,supportWebp:function(){if(!i)return!1;var e=!0,t=document;try{var n=t.createElement("object");n.type="image/webp",n.style.visibility="hidden",n.innerHTML="!",t.body.appendChild(n),e=!n.offsetWidth,t.body.removeChild(n)}catch(t){e=!1}return e}(),filter:E||{},adapter:A||{},observer:!!T,observerOptions:$||L},this._initEvent(),this.lazyLoadHandler=(n=this._lazyLoadHandler.bind(this),r=this.options.throttleWait,s=null,a=0,function(){if(!s){var e=this,t=arguments,i=function(){a=Date.now(),s=!1,n.apply(e,t)};Date.now()-a>=r?i():s=setTimeout(i,r)}}),this.setMode(this.options.observer?o.observer:o.event)}return n(f,[{key:"config",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this.options,e)}},{key:"performance",value:function(){var e=[];return this.ListenerQueue.map(function(t){e.push(t.performance())}),e}},{key:"addLazyBox",value:function(e){this.ListenerQueue.push(e),i&&(this._addListenerTarget(window),this._observer&&this._observer.observe(e.el),e.$el&&e.$el.parentNode&&this._addListenerTarget(e.$el.parentNode))}},{key:"add",value:function(e,t,n){var r=this;if(function(e,t){for(var n=!1,i=0,r=e.length;i<r;i++)if(t(e[i])){n=!0;break}return n}(this.ListenerQueue,function(t){return t.el===e}))return this.update(e,t),h.nextTick(this.lazyLoadHandler);var o=this._valueFormatter(t.value),s=o.src,a=o.loading,l=o.error;h.nextTick(function(){s=u(e,r.options.scale)||s,r._observer&&r._observer.observe(e);var o=Object.keys(t.modifiers)[0],d=void 0;o&&(d=(d=n.context.$refs[o])?d.$el||d:document.getElementById(o)),d||(d=p(e));var c=new y({bindType:t.arg,$parent:d,el:e,loading:a,error:l,src:s,elRenderer:r._elRenderer.bind(r),options:r.options});r.ListenerQueue.push(c),i&&(r._addListenerTarget(window),r._addListenerTarget(d)),r.lazyLoadHandler(),h.nextTick(function(){return r.lazyLoadHandler()})})}},{key:"update",value:function(e,t){var n=this,i=this._valueFormatter(t.value),r=i.src,o=i.loading,s=i.error;r=u(e,this.options.scale)||r;var a=l(this.ListenerQueue,function(t){return t.el===e});a&&a.update({src:r,loading:o,error:s}),this._observer&&this._observer.observe(e),this.lazyLoadHandler(),h.nextTick(function(){return n.lazyLoadHandler()})}},{key:"remove",value:function(e){if(e){this._observer&&this._observer.unobserve(e);var t=l(this.ListenerQueue,function(t){return t.el===e});t&&(this._removeListenerTarget(t.$parent),this._removeListenerTarget(window),s(this.ListenerQueue,t)&&t.destroy())}}},{key:"removeComponent",value:function(e){e&&(s(this.ListenerQueue,e),this._observer&&this._observer.unobserve(e.el),e.$parent&&e.$el.parentNode&&this._removeListenerTarget(e.$el.parentNode),this._removeListenerTarget(window))}},{key:"setMode",value:function(e){var t=this;r||e!==o.observer||(e=o.event),this.mode=e,e===o.event?(this._observer&&(this.ListenerQueue.forEach(function(e){t._observer.unobserve(e.el)}),this._observer=null),this.TargetQueue.forEach(function(e){t._initListen(e.el,!0)})):(this.TargetQueue.forEach(function(e){t._initListen(e.el,!1)}),this._initIntersectionObserver())}},{key:"_addListenerTarget",value:function(e){if(e){var t=l(this.TargetQueue,function(t){return t.el===e});return t?t.childrenCount++:(t={el:e,id:++this.TargetIndex,childrenCount:1,listened:!0},this.mode===o.event&&this._initListen(t.el,!0),this.TargetQueue.push(t)),this.TargetIndex}}},{key:"_removeListenerTarget",value:function(e){var t=this;this.TargetQueue.forEach(function(n,i){n.el===e&&(n.childrenCount--,n.childrenCount||(t._initListen(n.el,!1),t.TargetQueue.splice(i,1),n=null))})}},{key:"_initListen",value:function(e,t){var n=this;this.options.ListenEvents.forEach(function(i){return c[t?"on":"off"](e,i,n.lazyLoadHandler)})}},{key:"_initEvent",value:function(){var e=this;this.Event={listeners:{loading:[],loaded:[],error:[]}},this.$on=function(t,n){e.Event.listeners[t].push(n)},this.$once=function(t,n){var i=e;e.$on(t,function e(){i.$off(t,e),n.apply(i,arguments)})},this.$off=function(t,n){n?s(e.Event.listeners[t],n):e.Event.listeners[t]=[]},this.$emit=function(t,n,i){e.Event.listeners[t].forEach(function(e){return e(n,i)})}}},{key:"_lazyLoadHandler",value:function(){var e=this;console.log(this);this.ListenerQueue.forEach(function(t,n){t.state.loaded||t.checkInView()&&t.load(function(){return e.ListenerQueue.splice(n,1)})})}},{key:"_initIntersectionObserver",value:function(){var e=this;r&&(this._observer=new IntersectionObserver(this._observerHandler.bind(this),this.options.observerOptions),this.ListenerQueue.length&&this.ListenerQueue.forEach(function(t){e._observer.observe(t.el)}))}},{key:"_observerHandler",value:function(e,t){var n=this;e.forEach(function(e){e.isIntersecting&&n.ListenerQueue.forEach(function(t){if(t.el===e.target){if(t.state.loaded)return n._observer.unobserve(t.el);t.load()}})})}},{key:"_elRenderer",value:function(e,t,n){if(e.el){var i=e.el,r=e.bindType,o=void 0;switch(t){case"loading":o=e.loading;break;case"error":o=e.error;break;default:o=e.src}if(r?i.style[r]="url("+o+")":i.getAttribute("src")!==o&&i.setAttribute("src",o),i.setAttribute("lazy",t),this.$emit(t,e,n),this.options.adapter[t]&&this.options.adapter[t](e,this.options),this.options.dispatchEvent){var s=new CustomEvent(t,{detail:e});i.dispatchEvent(s)}}}},{key:"_valueFormatter",value:function(t){var n,i=t,r=this.options.loading,o=this.options.error;return null!==(n=t)&&"object"===(void 0===n?"undefined":e(n))&&(t.src||this.options.silent||console.error("Vue Lazyload warning: miss src with "+t),i=t.src,r=t.loading||this.options.loading,o=t.error||this.options.error),{src:i,loading:r,error:o}}}]),f}()}return{install:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new(w(e))(n),o="2"===e.version.split(".")[0];e.prototype.$Lazyload=r,n.lazyComponent&&e.component("lazy-component",(t=r,{props:{tag:{type:String,default:"div"}},render:function(e){return!1===this.show?e(this.tag):e(this.tag,null,this.$slots.default)},data:function(){return{el:null,state:{loaded:!1},rect:{},show:!1}},mounted:function(){this.el=this.$el,t.addLazyBox(this),t.lazyLoadHandler()},beforeDestroy:function(){t.removeComponent(this)},methods:{getRect:function(){this.rect=this.$el.getBoundingClientRect()},checkInView:function(){return this.getRect(),i&&this.rect.top<window.innerHeight*t.options.preLoad&&this.rect.bottom>0&&this.rect.left<window.innerWidth*t.options.preLoad&&this.rect.right>0},load:function(){this.show=!0,this.state.loaded=!0,this.$emit("show",this)}}})),o?e.directive("lazy",{bind:r.add.bind(r),update:r.update.bind(r),componentUpdated:r.lazyLoadHandler.bind(r),unbind:r.remove.bind(r)}):e.directive("lazy",{bind:r.lazyLoadHandler.bind(r),update:function(e,t){a(this.vm.$refs,this.vm.$els),r.add(this.el,{modifiers:this.modifiers||{},arg:this.arg,value:e,oldValue:t},{context:this.vm})},unbind:function(){r.remove(this.el)}})}}});
